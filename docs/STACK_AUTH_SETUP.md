# ğŸ” Stack Auth ç”¨æˆ·è®¤è¯ç³»ç»Ÿè®¾ç½®æŒ‡å—

## ğŸ“… è®¾ç½®æ—¥æœŸ
2025å¹´10æœˆ31æ—¥

## ğŸ¯ æ¦‚è¿°

Python é­”æ³•å­¦é™¢ç°å·²é›†æˆ **Stack Auth** ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼

---

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

### æœ‰è®¤è¯ç³»ç»Ÿ
- âœ… æ¯ä¸ªç”¨æˆ·ç‹¬ç«‹çš„å­¦ä¹ è¿›åº¦
- âœ… è·¨è®¾å¤‡åŒæ­¥å­¦ä¹ æ•°æ®
- âœ… æ”¯æŒæ’è¡Œæ¦œåŠŸèƒ½
- âœ… æ”¯æŒæˆå°±ç³»ç»Ÿ
- âœ… ç”¨æˆ·å¤´åƒå’Œä¸ªäººèµ„æ–™
- âœ… å®‰å…¨çš„ç”¨æˆ·æ•°æ®

### æ— è®¤è¯ç³»ç»Ÿï¼ˆdemoæ¨¡å¼ï¼‰
- âœ… ä½¿ç”¨ `demo-user` ä½œä¸ºé»˜è®¤ç”¨æˆ·
- âœ… æ‰€æœ‰è®¿é—®è€…å…±äº«å­¦ä¹ è¿›åº¦
- âœ… é€‚åˆæ¼”ç¤ºå’Œä¸ªäººå­¦ä¹ 
- âš ï¸ æ— æ³•ä¿è¯æ•°æ®å®‰å…¨

---

## ğŸš€ å¿«é€Ÿè®¾ç½®

### æ­¥éª¤ 1: æ³¨å†Œ Stack Auth

1. è®¿é—® [Stack Auth](https://stack-auth.com/)
2. ç‚¹å‡» "Get Started" åˆ›å»ºè´¦å·
3. åˆ›å»ºæ–°é¡¹ç›®
4. è®°å½•ä»¥ä¸‹å‡­è¯ï¼š
   - Project ID
   - Publishable Client Key
   - Secret Server Key

### æ­¥éª¤ 2: é…ç½®ç¯å¢ƒå˜é‡

åœ¨ `.env.local` æ–‡ä»¶ä¸­æ·»åŠ ï¼š

```env
# Stack Auth é…ç½®
NEXT_PUBLIC_STACK_PROJECT_ID="proj_xxxxx"
NEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY="pk_xxxxx"
STACK_SECRET_SERVER_KEY="sk_xxxxx"
```

### æ­¥éª¤ 3: å¯åŠ¨åº”ç”¨

```bash
npm run dev
```

### æ­¥éª¤ 4: æµ‹è¯•è®¤è¯

1. è®¿é—® http://localhost:3000
2. ç‚¹å‡»å³ä¸Šè§’"ç™»å½•"æŒ‰é’®
3. æ³¨å†Œæ–°è´¦å·æˆ–ç™»å½•
4. å¼€å§‹ä½ çš„ä¸ªäººå­¦ä¹ æ—…ç¨‹ï¼

---

## ğŸ“ å·²åˆ›å»ºçš„æ–‡ä»¶

### è®¤è¯é…ç½®
1. âœ… `stack.ts` - Stack Auth é…ç½®æ–‡ä»¶
2. âœ… `app/handler/[...stack]/page.tsx` - è®¤è¯å¤„ç†é¡µé¢
3. âœ… `components/ClientNavBar.tsx` - ç”¨æˆ·å¯¼èˆªæ ç»„ä»¶

### å·²æ›´æ–°çš„æ–‡ä»¶
4. âœ… `app/layout.tsx` - æ·»åŠ  StackProvider
5. âœ… `app/dashboard/page.tsx` - ä½¿ç”¨çœŸå®ç”¨æˆ·ID
6. âœ… `app/levels/[id]/page.tsx` - ä½¿ç”¨çœŸå®ç”¨æˆ·ID

---

## ğŸ¨ è®¤è¯é¡µé¢è®¾è®¡

### ç™»å½•é¡µé¢
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                          â”‚
â”‚        âœ¨ Pythoné­”æ³•å­¦é™¢ âœ¨              â”‚
â”‚      å¼€å§‹ä½ çš„é­”æ³•å­¦ä¹ ä¹‹æ—…                 â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                    â”‚  â”‚
â”‚  â”‚      Stack Auth ç™»å½•ç»„ä»¶            â”‚  â”‚
â”‚  â”‚                                    â”‚  â”‚
â”‚  â”‚  â€¢ é‚®ç®±ç™»å½•                         â”‚  â”‚
â”‚  â”‚  â€¢ Google ç™»å½•                     â”‚  â”‚
â”‚  â”‚  â€¢ GitHub ç™»å½•                     â”‚  â”‚
â”‚  â”‚                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚
â”‚  ç™»å½•åå³å¯ä¿å­˜å­¦ä¹ è¿›åº¦å’Œè·å¾—æˆå°±         â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’» ä»£ç å®ç°

### Stack Auth é…ç½® (`stack.ts`)

```typescript
import "server-only";
import { StackServerApp } from "@stackframe/stack";

export const stackServerApp = new StackServerApp({
  tokenStore: "nextjs-cookie",
  urls: {
    signIn: "/handler/sign-in",
    signUp: "/handler/sign-up",
    afterSignIn: "/dashboard",
    afterSignOut: "/",
    afterSignUp: "/dashboard",
    home: "/",
  },
});
```

### å®¢æˆ·ç«¯ä½¿ç”¨

```typescript
'use client';
import { useUser } from "@stackframe/stack";

export default function MyComponent() {
  const user = useUser();
  
  if (!user) {
    return <div>è¯·å…ˆç™»å½•</div>;
  }
  
  return <div>æ¬¢è¿, {user.displayName}!</div>;
}
```

### æœåŠ¡å™¨ç«¯ä½¿ç”¨

```typescript
import { stackServerApp } from "@/stack";

export default async function ServerPage() {
  const user = await stackServerApp.getUser();
  
  if (!user) {
    redirect('/handler/sign-in');
  }
  
  // ä½¿ç”¨ user.id
}
```

---

## ğŸ”„ ç”¨æˆ·æµç¨‹

### é¦–æ¬¡è®¿é—®
```
è®¿é—®ç½‘ç«™
    â†“
æœªç™»å½•çŠ¶æ€
    â†“
ç‚¹å‡»"ç™»å½•"æŒ‰é’®
    â†“
è·³è½¬åˆ°ç™»å½•é¡µé¢
    â†“
é€‰æ‹©ç™»å½•æ–¹å¼
    â†“
å®Œæˆç™»å½•
    â†“
è·³è½¬åˆ°ä»ªè¡¨æ¿
    â†“
å¼€å§‹å­¦ä¹ 
```

### å·²ç™»å½•ç”¨æˆ·
```
è®¿é—®ç½‘ç«™
    â†“
è‡ªåŠ¨è¯†åˆ«ç”¨æˆ·
    â†“
åŠ è½½ä¸ªäººè¿›åº¦
    â†“
ç»§ç»­å­¦ä¹ 
```

---

## ğŸ¯ åŠŸèƒ½è¯´æ˜

### ç”¨æˆ·æŒ‰é’®ç»„ä»¶

å½“ç”¨æˆ·ç™»å½•åï¼Œå¯¼èˆªæ ä¼šæ˜¾ç¤ºï¼š
- ğŸ‘¤ ç”¨æˆ·å¤´åƒ
- ğŸ“Š ä¸‹æ‹‰èœå•ï¼š
  - ä¸ªäººèµ„æ–™
  - è®¾ç½®
  - é€€å‡ºç™»å½•

### æ•°æ®åŒæ­¥

ç”¨æˆ·çš„ä»¥ä¸‹æ•°æ®ä¼šè‡ªåŠ¨åŒæ­¥ï¼š
- âœ… å…³å¡å®ŒæˆçŠ¶æ€
- âœ… ç»ƒä¹ é¢˜å®Œæˆè®°å½•
- âœ… è·å¾—çš„ç§¯åˆ†
- âœ… å­¦ä¹ è¿›åº¦

---

## ğŸ” å®‰å…¨ç‰¹æ€§

### Stack Auth æä¾›
- ğŸ”’ å®‰å…¨çš„å¯†ç å­˜å‚¨ï¼ˆbcryptï¼‰
- ğŸ”‘ JWT token è®¤è¯
- ğŸ›¡ï¸ CSRF ä¿æŠ¤
- ğŸ” XSS é˜²æŠ¤
- ğŸ“§ é‚®ç®±éªŒè¯
- ğŸ”„ ä¼šè¯ç®¡ç†

### åº”ç”¨å±‚ä¿æŠ¤
- âœ… æ‰€æœ‰APIè·¯ç”±éªŒè¯ç”¨æˆ·
- âœ… å®¢æˆ·ç«¯è·¯ç”±ä¿æŠ¤
- âœ… æœåŠ¡å™¨ç«¯è·¯ç”±ä¿æŠ¤
- âœ… æ•°æ®è®¿é—®æ§åˆ¶

---

## ğŸ“Š æ•°æ®åº“é›†æˆ

### ç”¨æˆ·è¡¨ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
Stack Auth ä¼šåœ¨ Neon æ•°æ®åº“ä¸­è‡ªåŠ¨åˆ›å»ºç”¨æˆ·è¡¨ã€‚

### å…³è”ç”¨æˆ·æ•°æ®
ç°æœ‰è¡¨é€šè¿‡ `user_id` å­—æ®µå…³è”ï¼š

```sql
-- user_progress è¡¨
user_id VARCHAR(255) -- Stack Auth ç”¨æˆ·ID

-- æŸ¥è¯¢ç”¨æˆ·è¿›åº¦
SELECT * FROM user_progress WHERE user_id = 'user_xxxxx';
```

---

## ğŸ¨ è‡ªå®šä¹‰ä¸»é¢˜

### åŒ¹é…é­”æ³•å­¦é™¢ä¸»é¢˜

è®¤è¯é¡µé¢å·²ç»ä½¿ç”¨é­”æ³•å­¦é™¢ä¸»é¢˜ï¼š
- ğŸ¨ ç´«ç²‰æ¸å˜èƒŒæ™¯
- âœ¨ é­”æ³•å­¦é™¢æ ‡é¢˜
- ğŸ”® æ¯›ç»ç’ƒæ•ˆæœ
- ğŸ’« ä¸»é¢˜ä¸€è‡´æ€§

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### 1. æœ¬åœ°æµ‹è¯•

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# è®¿é—®è®¤è¯é¡µé¢
http://localhost:3000/handler/sign-in
```

### 2. æ³¨å†Œæµ‹è¯•ç”¨æˆ·

- è¾“å…¥é‚®ç®±
- è®¾ç½®å¯†ç 
- å®Œæˆæ³¨å†Œ

### 3. éªŒè¯åŠŸèƒ½

- âœ… ç™»å½•æˆåŠŸåè·³è½¬åˆ°ä»ªè¡¨æ¿
- âœ… å¯¼èˆªæ æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
- âœ… å­¦ä¹ è¿›åº¦æ­£ç¡®ä¿å­˜
- âœ… é€€å‡ºç™»å½•æ­£å¸¸

---

## ğŸ”„ åˆ‡æ¢æ¨¡å¼

### Demo æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰

ä¸é…ç½® Stack Auth ç¯å¢ƒå˜é‡ï¼š
- ä½¿ç”¨ `demo-user`
- æ‰€æœ‰äººå…±äº«è¿›åº¦
- æ— éœ€ç™»å½•

### è®¤è¯æ¨¡å¼

é…ç½® Stack Auth ç¯å¢ƒå˜é‡ï¼š
- ä½¿ç”¨çœŸå®ç”¨æˆ·ID
- ä¸ªäººç‹¬ç«‹è¿›åº¦
- éœ€è¦ç™»å½•

**ä»£ç ä¼šè‡ªåŠ¨é€‚é…ï¼**

```typescript
const userId = user?.id || 'demo-user';
```

---

## ğŸ“š Stack Auth åŠŸèƒ½

### æ”¯æŒçš„ç™»å½•æ–¹å¼
- ğŸ“§ é‚®ç®± + å¯†ç 
- ğŸ” Google OAuth
- ğŸ’» GitHub OAuth
- ğŸ¦ Twitter OAuth
- ğŸ¯ æ›´å¤š OAuth æä¾›å•†...

### ç”¨æˆ·ç®¡ç†åŠŸèƒ½
- âœ… æ³¨å†Œ/ç™»å½•/ç™»å‡º
- âœ… å¯†ç é‡ç½®
- âœ… é‚®ç®±éªŒè¯
- âœ… ä¸ªäººèµ„æ–™ç¼–è¾‘
- âœ… ä¼šè¯ç®¡ç†

---

## ğŸ› ï¸ é«˜çº§é…ç½®

### è‡ªå®šä¹‰é‡å®šå‘

```typescript
// stack.ts
urls: {
  signIn: "/handler/sign-in",
  afterSignIn: "/dashboard",     // ç™»å½•åè·³è½¬
  afterSignOut: "/",              // ç™»å‡ºåè·³è½¬
  afterSignUp: "/dashboard",      // æ³¨å†Œåè·³è½¬
}
```

### è‡ªå®šä¹‰UIç»„ä»¶

```typescript
import { useUser } from "@stackframe/stack";

export function CustomUserProfile() {
  const user = useUser();
  
  return (
    <div className="magic-card p-6">
      <h2>{user?.displayName}</h2>
      <p>{user?.primaryEmail}</p>
    </div>
  );
}
```

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. ä¿æŠ¤ç§å¯†è·¯ç”±

```typescript
// app/dashboard/page.tsx
const user = useUser({ or: 'redirect' });
// æœªç™»å½•è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µ
```

### 2. å¯é€‰ç™»å½•

```typescript
// app/levels/[id]/page.tsx
const user = useUser();  // ä¸å¼ºåˆ¶ç™»å½•
const userId = user?.id || 'demo-user';
```

### 3. æœåŠ¡å™¨ç«¯éªŒè¯

```typescript
// APIè·¯ç”±ä¸­
import { stackServerApp } from "@/stack";

export async function GET(request: Request) {
  const user = await stackServerApp.getUser();
  if (!user) {
    return new Response('Unauthorized', { status: 401 });
  }
  // å¤„ç†è¯·æ±‚...
}
```

---

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | Demoæ¨¡å¼ | è®¤è¯æ¨¡å¼ |
|------|----------|----------|
| **å­¦ä¹ è¿›åº¦** | å…±äº« | ç‹¬ç«‹ |
| **æ•°æ®å®‰å…¨** | ä½ | é«˜ |
| **è·¨è®¾å¤‡åŒæ­¥** | âŒ | âœ… |
| **æ’è¡Œæ¦œ** | âŒ | âœ… |
| **æˆå°±ç³»ç»Ÿ** | âŒ | âœ… |
| **ä¸ªäººèµ„æ–™** | âŒ | âœ… |
| **ç¤¾åŒºåŠŸèƒ½** | âŒ | âœ… |

---

## ğŸŠ é›†æˆå®Œæˆ

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                        â•‘
â•‘        ğŸ” Stack Auth è®¤è¯ç³»ç»Ÿé›†æˆå®Œæˆï¼ğŸ”              â•‘
â•‘                                                        â•‘
â•‘  âœ… Stack Auth é…ç½®æ–‡ä»¶åˆ›å»º                           â•‘
â•‘  âœ… è®¤è¯å¤„ç†è·¯ç”±åˆ›å»º                                  â•‘
â•‘  âœ… ç”¨æˆ·å¯¼èˆªæ ç»„ä»¶åˆ›å»º                                â•‘
â•‘  âœ… ä»ªè¡¨æ¿é›†æˆç”¨æˆ·ç³»ç»Ÿ                                â•‘
â•‘  âœ… å…³å¡é¡µé¢é›†æˆç”¨æˆ·ç³»ç»Ÿ                              â•‘
â•‘  âœ… æ”¯æŒ demo æ¨¡å¼å’Œè®¤è¯æ¨¡å¼                          â•‘
â•‘                                                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ“ å¾…åŠäº‹é¡¹

### é…ç½® Stack Authï¼ˆ5åˆ†é’Ÿï¼‰
1. [ ] è®¿é—® stack-auth.com æ³¨å†Œ
2. [ ] åˆ›å»ºæ–°é¡¹ç›®
3. [ ] å¤åˆ¶å‡­è¯åˆ° `.env.local`
4. [ ] é‡å¯å¼€å‘æœåŠ¡å™¨
5. [ ] æµ‹è¯•ç™»å½•åŠŸèƒ½

### å¯é€‰åŠŸèƒ½ï¼ˆåç»­ï¼‰
- [ ] æ·»åŠ ç”¨æˆ·ä¸ªäººèµ„æ–™é¡µé¢
- [ ] å®ç°æ’è¡Œæ¦œ
- [ ] æ·»åŠ æˆå°±ç³»ç»Ÿ
- [ ] å®ç°ç¤¾åŒºè®¨è®º

---

## ğŸš€ ç«‹å³ä½¿ç”¨

### Demo æ¨¡å¼ï¼ˆå½“å‰ï¼‰
```bash
# ç›´æ¥å¯åŠ¨ï¼Œæ— éœ€é…ç½®
npm run dev
```

### è®¤è¯æ¨¡å¼ï¼ˆæ¨èï¼‰
```bash
# 1. é…ç½®ç¯å¢ƒå˜é‡
# ç¼–è¾‘ .env.local æ·»åŠ  Stack Auth å‡­è¯

# 2. å¯åŠ¨æœåŠ¡
npm run dev

# 3. æµ‹è¯•ç™»å½•
# è®¿é—® http://localhost:3000
# ç‚¹å‡»"ç™»å½•"æŒ‰é’®
```

---

**é›†æˆå®Œæˆæ—¥æœŸ**: 2025å¹´10æœˆ31æ—¥  
**è®¤è¯æä¾›å•†**: Stack Auth  
**æ•°æ®åº“**: Neon PostgreSQL  
**çŠ¶æ€**: âœ… é›†æˆå®Œæˆï¼Œå¯é€‰å¯ç”¨  
**æ¨¡å¼**: Demoæ¨¡å¼ â‡„ è®¤è¯æ¨¡å¼  

**ğŸ” Python é­”æ³•å­¦é™¢ï¼Œç°åœ¨æ›´å®‰å…¨ï¼ğŸ”**

