# 🗄️ 成就系统数据库初始化指南

## 🎯 三种初始化方法

### 方法1：使用自动化脚本（推荐）⭐

```bash
# 1. 设置数据库连接
export DATABASE_URL="postgresql://user:password@host/database"

# 2. 运行自动化脚本
./init-achievements-db.sh
```

**优点**：
- ✅ 全自动，一键完成
- ✅ 包含错误检查
- ✅ 显示详细进度
- ✅ 友好的提示信息

---

### 方法2：使用 npm 脚本

```bash
# 1. 设置数据库连接
export DATABASE_URL="postgresql://user:password@host/database"

# 2. 运行初始化
npm run init-achievements
```

**优点**：
- ✅ 简单直接
- ✅ 使用 package.json 脚本
- ✅ 适合开发环境

---

### 方法3：在 Neon 控制台手动执行

1. 登录 [Neon 控制台](https://console.neon.tech/)
2. 选择你的项目和数据库
3. 打开 SQL Editor
4. 复制并执行 `achievement-system.sql` 文件内容

```bash
# 查看 SQL 文件内容
cat achievement-system.sql
```

**优点**：
- ✅ 可视化界面
- ✅ 可以查看执行结果
- ✅ 适合首次设置

---

## 📋 获取数据库连接字符串

### 从 Neon 控制台获取

1. 访问 https://console.neon.tech/
2. 选择你的项目
3. 点击 "Connection Details" 或 "连接详情"
4. 复制连接字符串，格式类似：
   ```
   postgresql://username:password@ep-xxx.region.aws.neon.tech/dbname
   ```

### 设置环境变量

```bash
# 临时设置（当前终端会话）
export DATABASE_URL="your-connection-string"

# 或者添加到 .env.local 文件
echo 'DATABASE_URL="your-connection-string"' >> .env.local
```

---

## ✅ 验证初始化

### 运行成功后，你应该看到：

```
🎉 成就系统初始化完成！

📊 统计信息：
   总成就数: 25
   - 普通 (Common): 8
   - 稀有 (Rare): 7
   - 史诗 (Epic): 6
   - 传奇 (Legendary): 4
```

### 验证数据库

```sql
-- 检查表是否创建
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public' 
AND table_name IN ('achievements', 'user_achievements', 'user_stats');

-- 检查成就数量
SELECT COUNT(*) FROM achievements;  -- 应该返回 25

-- 查看所有成就
SELECT key, title, rarity, points FROM achievements ORDER BY rarity, points;
```

---

## 🚀 下一步

初始化完成后：

```bash
# 1. 启动应用
npm run dev

# 2. 访问成就页面
open http://localhost:3000/achievements

# 3. 或者访问学习中心开始学习
open http://localhost:3000/dashboard
```

---

## 🔧 故障排除

### ❌ 错误：DATABASE_URL 未设置

**解决方案**：
```bash
export DATABASE_URL="your-connection-string"
```

### ❌ 错误：连接被拒绝

**原因**：
- 数据库连接字符串错误
- 网络问题
- Neon 数据库未启动

**解决方案**：
1. 检查连接字符串是否正确
2. 在 Neon 控制台测试连接
3. 确认数据库正在运行

### ❌ 错误：表已存在

**原因**：数据库已经初始化过

**解决方案**：
- 这是正常的，脚本会更新现有数据
- 使用 `ON CONFLICT DO UPDATE` 自动处理

### ❌ 错误：权限不足

**解决方案**：
```bash
chmod +x init-achievements-db.sh
```

---

## 📚 相关文件

- `init-achievements-db.sh` - 自动化初始化脚本
- `achievement-system.sql` - 纯 SQL 初始化脚本
- `scripts/init-achievements.ts` - TypeScript 初始化脚本
- `ACHIEVEMENT_QUICKSTART.md` - 快速启动指南
- `成就系统使用说明.md` - 详细使用说明

---

## 💡 提示

1. **首次使用**：推荐使用方法1（自动化脚本）
2. **开发环境**：可以使用方法2（npm 脚本）
3. **生产环境**：建议使用方法3（控制台手动执行）

---

## 🎊 完成！

数据库初始化完成后，你就可以开始使用完整的成就系统了！

**祝你收集成就愉快！** 🏆✨

